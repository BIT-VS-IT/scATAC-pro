footprint_stats[P_values <=0.05]
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colours = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank())
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank())
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 1, 2)]
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank())
footprint_stats.file = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/cluster_0_cluster_1_statistics.txt')
if(file.exists(footprint_stats.file)){
footprint_stats = fread(footprint_stats.file)
footprint_stats[, 'motif1' := unlist(strsplit(Motif, '.', fixed = T))[3], by = Motif]
footprint_stats[, 'motif2' := unlist(strsplit(Motif, '.', fixed = T))[4], by = Motif]
footprint_stats[, 'motif2' := ifelse(is.na(motif2), "", motif2)]
footprint_stats[, 'motif' := paste0(motif1, motif2)]
footprint_stats[, c('motif1', 'motif2') := NULL]
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 1, 2)]
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank(), legend.text = element_blank())
}
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank(), legend.title = element_blank())
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 'Sig', 'non-Sig')]
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank(), legend.title = element_blank())
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 'Diff', 'non-Diff')]
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank(), legend.title = element_blank())
}
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank(), legend.title = element_blank())
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust=0,vjust=0)
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0.1,vjust = 0.1)
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0.1,vjust = 0.1, check_overlap = T)
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0, vjust = 0)
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.1, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0, vjust = 0)
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.2, .9), legend. axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.2, .9), legend. axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.2, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0, vjust = 0)
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0, vjust = 0)
library(ggrepel)
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0, vjust = 0) + geom_text_repel()
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
geom_text(aes(label=ifelse(isSig == 'Diff', as.character(motif),'')),hjust = 0, vjust = 0) + ggrepel::geom_text_repel()
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') +
ggrepel::geom_text_repel(data = footprint_stats[isSig == 'Diff'], aes(label = motif))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + ggrepel::geom_text_repel(data = footprint_stats[isSig == 'Diff'])
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + ggrepel::geom_label_repel(data = footprint_stats[isSig == 'Diff'], aes(label = motif))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_label_repel(data = footprint_stats[isSig == 'Diff'], aes(label = motif))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_label_repel(data = footprint_stats[isSig == 'Diff', ], aes(label = motif))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_label_repel(data = footprint_stats[isSig == 'Diff', ], aes(label = footprint_stats[isSig == 'Diff', ]$motif))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig))) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = footprint_stats[isSig == 'Diff', ], aes(label = footprint_stats[isSig == 'Diff', ]$motif))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = footprint_stats[isSig == 'Diff', ], aes(label = footprint_stats[isSig == 'Diff', ]$motif))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = footprint_stats[isSig == 'Diff', ])
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank())
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = footprint_stats[isSig == 'Diff', ])
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
+ geom_text_repel(data = footprint_stats[isSig == 'Diff', ])
p <- ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
p
p + geom_text_repel(data = footprint_stats[isSig == 'Diff', ])
library(ggplot2)
library(ggrepel)
nba <- read.csv("http://datasets.flowingdata.com/ppg2008.csv", sep = ",")
nbaplot <- ggplot(nba, aes(x= MIN, y = PTS)) +
geom_point(color = "blue", size = 3)
nbaplot +
geom_label_repel(aes(label = Name),
box.padding   = 0.35,
point.padding = 0.5,
segment.color = 'grey50') +
theme_classic()
ggplot(nba, aes(x= MIN, y = PTS, label = Name)) +
geom_point(color = dplyr::case_when(nba$PTS > 25 ~ "#1b9e77",
nba$PTS < 18 ~ "#d95f02",
TRUE ~ "#7570b3"),
size = 3, alpha = 0.8) +
geom_text_repel(data          = subset(nba, PTS > 25),
nudge_y       = 32 - subset(nba, PTS > 25)$PTS,
size          = 4,
box.padding   = 1.5,
point.padding = 0.5,
force         = 100,
segment.size  = 0.2,
segment.color = "grey50",
direction     = "x")
ggplot(nba, aes(x= MIN, y = PTS, label = Name)) +
geom_point(color = dplyr::case_when(nba$PTS > 25 ~ "#1b9e77",
nba$PTS < 18 ~ "#d95f02",
TRUE ~ "#7570b3"),
size = 3, alpha = 0.8) +
geom_text_repel(data          = subset(nba, PTS > 25),
nudge_y       = 32 - subset(nba, PTS > 25)$PTS,
size          = 4,
box.padding   = 1.5,
point.padding = 0.5,
force         = 100,
segment.size  = 0.2,
segment.color = "grey50",
direction     = "x") +
geom_label_repel(data         = subset(nba, PTS < 18),
nudge_y       = 16 - subset(nba, PTS < 18)$PTS,
size          = 4,
box.padding   = 0.5,
point.padding = 0.5,
force         = 100,
segment.size  = 0.2,
segment.color = "grey50",
direction     = "x")
ggplot(nba, aes(x= MIN, y = PTS, label = Name)) +
geom_point(color = dplyr::case_when(nba$PTS > 25 ~ "#1b9e77",
nba$PTS < 18 ~ "#d95f02",
TRUE ~ "#7570b3"),
size = 3, alpha = 0.8) +
geom_text_repel(data          = subset(nba, PTS > 25),
nudge_y       = 32 - subset(nba, PTS > 25)$PTS,
size          = 4,
box.padding   = 1.5,
point.padding = 0.5,
force         = 100,
segment.size  = 0.2,
segment.color = "grey50",
direction     = "x") +
geom_label_repel(data         = subset(nba, PTS < 18),
nudge_y       = 16 - subset(nba, PTS < 18)$PTS,
size          = 4,
box.padding   = 0.5,
point.padding = 0.5,
force         = 100,
segment.size  = 0.2,
segment.color = "grey50",
direction     = "x") +
scale_x_continuous(expand = expand_scale(mult = c(0.2, .2))) +
scale_y_continuous(expand = expand_scale(mult = c(0.1, .1))) +
theme_classic(base_size = 16)
p <- ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
p = p + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'))
p
ggplot(nba, aes(x= MIN, y = PTS, label = Name)) +
geom_point(color = dplyr::case_when(nba$PTS > 25 ~ "#1b9e77",
nba$PTS < 18 ~ "#d95f02",
TRUE ~ "#7570b3"),
size = 3, alpha = 0.8) +
geom_text_repel(data          = subset(nba, PTS > 25))
subset(footprint_stats, isSig == 'Diff')
subset(footprint_stats, isSig == 'Diff')
p <- ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
p + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'))
ggplot(nba, aes(x= MIN, y = PTS, label = Name))
ggplot(nba, aes(x= MIN, y = PTS, label = Name)) + geom_point()
dim(nba)
ggplot(nba, aes(x= MIN, y = PTS, label = Name)) + geom_point() + geom_text_repel(data          = subset(nba, PTS > 25))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
+ geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'))
ggplot(data = footprint_stats, aes(x = 1:nrow(footprint_stats), y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'))
ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'))
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
p = p + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'))
p
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
p = p + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 100, direction = 'x')
p
p
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0')
p = p + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 100)
p
p
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10)
p
p
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.3, .9),  legend.text = element_text(size=14), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10)
p
footprint_stats
bc_stat
bc_stat = fread(params$bc_stat_file)
bc_stat
p1
library(flexdashboard)
library(data.table)
library(magrittr)
library(kableExtra)
library(RColorBrewer)
library(ggplot2)
library(plotly)
mapping_qc = fread(params$mapping_qc_file, header = F)
mapping_qc$frac = round(mapping_qc$V2/mapping_qc$V2[1], 3)
mapping_qc$frac = paste0(100*mapping_qc$frac, '%')
kable(mapping_qc, col.names = NULL, format = 'html') %>%
kable_styling("striped", full_width = F, position = 'left')
bc_stat = fread(params$bc_stat_file)
barcodes = fread(params$selected_bcs, header = F)$V1
qc_sele = bc_stat[bc %in% barcodes, ]
qc_nonsele = bc_stat[!bc %in% barcodes, ]
frags = fread(params$fragments_file)
names(frags) = c('chr', 'start', 'end', 'bc', 'ndup')
frags = frags[bc %in% barcodes]
ncells = length(barcodes)
frac.in.cell = paste0(round(sum(frags$ndup)/mapping_qc$V2[1], 3) * 100, '%')
frac.uniq = paste0(round(nrow(frags)/sum(frags$ndup), 3) * 100, '%')
cell.table = data.frame(c(paste0(ncells), frac.in.cell, frac.uniq))
rownames(cell.table) = c('Estimated # of cells', 'Fraction of MAPQ30 in cells',
'Library Complexity (non redudant fraction)')
kable(cell.table, row.names = T, col.names = NULL, format = 'html') %>%
kable_styling("striped", full_width = F, position = 'left')
set.cols = brewer.pal(n=5, name = 'Dark2')
tss.mat = fread(params$tss_escore_file)
tss.mat = tss.mat[, -c(1:6)]
tss.mat[is.na(tss.mat)] = 0
tss.escore = colSums(tss.mat)
ma <- function(x, n = 10){stats::filter(x, rep(1 / n, n), sides = 2)}
tss.escore = ma(tss.escore)
tss.escore = tss.escore[14:213]
df = data.table(index = 10*(-100:99), escore = tss.escore/tss.escore[1])
ggplot(data = df, aes(x = index, y = escore)) + geom_line(size = 1, col = set.cols[1]) +
xlab('Distance to TSS') + ylab('TSS enrichment score(bp)') + theme(legend.title=element_blank(), axis.text = element_text(size = 14))
qc_sele_df = data.table(frac = c(qc_sele$frac_peak, qc_sele$frac_tss, qc_sele$frac_promoter, qc_sele$frac_enh, qc_sele$frac_mito), 'type' = rep(c('Peaks', 'Tss', 'Promoter', 'Enhancer', 'Mito'), each = nrow(qc_sele)))
p0 <- ggplot(data = qc_sele_df, aes(y = frac, x = type, fill = type)) + ylab('Fraction') +
geom_boxplot(outlier.size = 0.01) +  theme(legend.position = 'none', axis.text = element_text(size = 14)) + xlab('')
#ggplotly(p0)
p0
frac_peak = sum(qc_sele$total_frags * qc_sele$frac_peak)/sum(qc_sele$total_frags)
frac_mito = sum(qc_sele$total_frags * qc_sele$frac_mito)/sum(qc_sele$total_frags)
frac_promoter = sum(qc_sele$total_frags * qc_sele$frac_promoter)/sum(qc_sele$total_frags)
frac_enh = sum(qc_sele$total_frags * qc_sele$frac_enhancer)/sum(qc_sele$total_frags)
frac_tss = sum(qc_sele$total_frags * qc_sele$frac_tss)/sum(qc_sele$total_frags)
fracs = data.frame(c(frac_peak, frac_mito, frac_promoter, frac_enh, frac_tss))
row.names(fracs) = c('Fraction in peaks', 'Fraction in mitocondrial chromosome',
'Fraction in promoters', 'Fraction in Enhancers(ENCODE)',
'Fraction in TSS')
colnames(fracs) = 'pr'
fracs$pr = round(fracs$pr, 3)
fracs$pr = paste0(100*fracs$pr, '%')
kable(fracs, row.names = T, col.names = NULL) %>%
kable_styling(full_width = F, position = 'left')
bc_stat[, 'group' := ifelse(bc %in% barcodes, 'cell', 'non-cell')]
p <- ggplot(data = bc_stat, aes(x = total_frags, col = group)) +
geom_density() + scale_x_continuous(trans = 'log10') +
theme(legend.position=c(.1, .9)) +  theme(legend.title=element_blank(),
axis.title = element_text(size = 14),
axis.text = element_text(size = 14)) + xlab('Total #fragments')
p
#ggplotly(p)
library(ggplot2)
library(plotly)
g <- ggplot(data = bc_stat[sample(1:nrow(bc_stat), 15000)], aes(x = total_frags, y = frac_peak, col = group)) + geom_point(size = 0.5) + scale_x_continuous(trans='log10') +
theme(legend.position=c(.9, .9)) +  theme(legend.title=element_blank(),
legend.text = element_text(size=14),
legend.background = NULL,
axis.text = element_text(size = 14),
axis.title = element_text(size = 14)) + xlab('Total #fragments') + ylab('Fraction in Peak')
#ggplotly(g)
g
ggplot(data = df, aes(x = index, y = escore)) + geom_line(size = 1, col = set.cols[1]) +
xlab('Distance to TSS') + ylab('TSS enrichment score(bp)') + theme(legend.title=element_blank(), axis.text = element_text(size = 14), axis.title = element_text(size = 14))
frags[, 'isize' := end - start]
frags = frags[sample(1:nrow(frags), 1000000), ]
p1 <- ggplot(data = frags[isize < 800], aes(x = isize)) +
geom_density() + xlab('insert size')
p1
p1 <- ggplot(data = frags[isize < 800], aes(x = isize)) +
geom_density() + xlab('insert size') + theme(legend.title=element_blank(),
legend.text = element_text(size=14),
legend.background = NULL,
axis.text = element_text(size = 14),
axis.title = element_text(size = 14))
p1
ggplotly(p1)
p1
p
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.26, .9),  legend.text = element_text(size=15), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10)
p
p
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.26, .9),  legend.text = element_text(size=15), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_label_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10)
p
qc_sele_df = data.table(frac = c(qc_sele$frac_peak, qc_sele$frac_tss, qc_sele$frac_promoter, qc_sele$frac_enh, qc_sele$frac_mito), 'type' = rep(c('Peaks', 'Tss', 'Promoter', 'Enhancer', 'Mito'), each = nrow(qc_sele)))
p0 <- ggplot(data = qc_sele_df, aes(y = frac, x = type, fill = type)) + ylab('Fraction') +
geom_boxplot(outlier.size = 0.01) +  theme(legend.position = 'none', axis.text = element_text(size = 15), axis.title = element_blank(size = 15)) + xlab('')
p0 <- ggplot(data = qc_sele_df, aes(y = frac, x = type, fill = type)) + ylab('Fraction') +
geom_boxplot(outlier.size = 0.01) +  theme(legend.position = 'none', axis.text = element_text(size = 15), axis.title = element_blank()) + xlab('')
p0
p0 <- ggplot(data = qc_sele_df, aes(y = frac, x = type, fill = type)) + ylab('Fraction') +
geom_boxplot(outlier.size = 0.01) +  theme(legend.position = 'none', axis.text = element_text(size = 15), axis.title.x = element_blank(), axis.title.y = element_text(size = 15)) + xlab('')
p0
tss.mat = fread('~/yuw1/run_scATAC-pro/output/downstream_analysis/EmptyDrop/data_by_cluster/footprint/JUND_signal.mtx.gz')
tss.mat = tss.mat[, -c(1:6)]
tss.mat[is.na(tss.mat)] = 0
tss.escore = colSums(tss.mat)
ma <- function(x, n = 10){stats::filter(x, rep(1 / n, n), sides = 2)}
dim(tss.escore)
length(tss.escore)
dim(tss.mat)
plot(tss.escore)
library(VisCello)
cello("/mnt/isilon/tan_lab/yuw1/R_work_dir/CPTCA/Pilot/Leukemia_out/integrated_scRNA_inputs4Cello")
dd = fread('/home/yuw1/yuw1/run_scATAC-pro/output/downstream_analysis/EmptyDrop/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/MA0018.3.CREB1.txt')
dd
plot(dd$cluster_1)
plot(dd$cluster_1, type = 'l')
lines(dd$cluster_0, col = 2)
dd = fread('/home/yuw1/yuw1/run_scATAC-pro/output/downstream_analysis/EmptyDrop/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/*JUND.txt')
dd = fread('/home/yuw1/yuw1/run_scATAC-pro/output/downstream_analysis/EmptyDrop/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/MA0491.1.JUND.txt')
plot(dd$cluster_1, type = 'l')
lines(dd$cluster_0, col = 2)
plot(dd$cluster_0, type = 'l')
lines(dd$cluster_1, col = 2)
range(dd$cluster_1)
footprint_stats[isSig == 'Diff']
tf.file.name = footprint_stats[motif == sele.motif]$Motif
#select a TF to show
sele.motif = 'CEBPE'
tf.file.name = footprint_stats[motif == sele.motif]$Motif
tf.file.name = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/', tf.file.name, '.txt')
dd = fread(tf.file.name)
nrow(dd)
dd
dd[, 'id' := -99:100]
dd
dd0 = rbind(subset(dd, select = - cluster_1))
dd0
dd1 = rbind(subset(dd, select = - cluster_0))
names(dd0)[1] = names(dd1)[1] = 'score'
dd = rbind(dd1, dd0)
dd$cluster = rep(c('cluster_1', 'cluster_0'), each = nrow(dd0))
dd
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line()
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(linetype = cluster)
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster))
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 2)
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.5)
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1)
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif)
p
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif)
ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif) + xlab('Distance to Motif')
p2 = ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif) + xlab('Distance to Motif')
grid.arrange(p, p2, ncol = 2)
library(flexdashboard)
library(data.table)
library(magrittr)
library(kableExtra)
library(RColorBrewer)
library(ggplot2)
library(plotly)
grid.arrange(p, p2, nrow = 2)
footprint_stats.file = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/cluster_0_cluster_1_statistics.txt')
if(file.exists(footprint_stats.file)){
library(ggrepel)
footprint_stats = fread(footprint_stats.file)
footprint_stats[, 'motif1' := unlist(strsplit(Motif, '.', fixed = T))[3], by = Motif]
footprint_stats[, 'motif2' := unlist(strsplit(Motif, '.', fixed = T))[4], by = Motif]
footprint_stats[, 'motif2' := ifelse(is.na(motif2), "", motif2)]
footprint_stats[, 'motif' := paste0(motif1, motif2)]
footprint_stats[, c('motif1', 'motif2') := NULL]
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 'Diff', 'non-Diff')]
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.26, .9),  legend.text = element_text(size=15), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10)
p
#select a TF to show
sele.motif = 'CEBPE'
tf.file.name = footprint_stats[motif == sele.motif]$Motif
tf.file.name = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/', tf.file.name, '.txt')
dd = fread(tf.file.name)
dd[, 'id' := -99:100]
dd0 = rbind(subset(dd, select = - cluster_1))
dd1 = rbind(subset(dd, select = - cluster_0))
names(dd0)[1] = names(dd1)[1] = 'score'
dd = rbind(dd1, dd0)
dd$cluster = rep(c('cluster_1', 'cluster_0'), each = nrow(dd0))
p2 = ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif) + xlab('Distance to Motif')
library(gridExtra)
grid.arrange(p, p2, nrow = 2)
}
footprint_stats.file = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/cluster_0_cluster_1_statistics.txt')
if(file.exists(footprint_stats.file)){
library(ggrepel)
footprint_stats = fread(footprint_stats.file)
footprint_stats[, 'motif1' := unlist(strsplit(Motif, '.', fixed = T))[3], by = Motif]
footprint_stats[, 'motif2' := unlist(strsplit(Motif, '.', fixed = T))[4], by = Motif]
footprint_stats[, 'motif2' := ifelse(is.na(motif2), "", motif2)]
footprint_stats[, 'motif' := paste0(motif1, motif2)]
footprint_stats[, c('motif1', 'motif2') := NULL]
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 'Diff', 'non-Diff')]
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.26, .9),  legend.text = element_text(size=15), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10)
p
#select a TF to show
sele.motif = 'CEBPE'
tf.file.name = footprint_stats[motif == sele.motif]$Motif
tf.file.name = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/', tf.file.name, '.txt')
dd = fread(tf.file.name)
dd[, 'id' := -99:100]
dd0 = rbind(subset(dd, select = - cluster_1))
dd1 = rbind(subset(dd, select = - cluster_0))
names(dd0)[1] = names(dd1)[1] = 'score'
dd = rbind(dd1, dd0)
dd$cluster = rep(c('cluster_1', 'cluster_0'), each = nrow(dd0))
p2 = ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif) + xlab('Distance to Motif') + theme(legend.title=element_blank(), legend.text = element_text(size=15), legend.background = NULL, axis.text = element_text(size = 15), axis.title = element_text(size = 15), legend.position = c(0.8, 0.8))
library(gridExtra)
grid.arrange(p, p2, nrow = 2)
}
library(grid)
footprint_stats.file = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/cluster_0_cluster_1_statistics.txt')
if(file.exists(footprint_stats.file)){
library(ggrepel)
library(gridExtra)
library(grid)
footprint_stats = fread(footprint_stats.file)
footprint_stats[, 'motif1' := unlist(strsplit(Motif, '.', fixed = T))[3], by = Motif]
footprint_stats[, 'motif2' := unlist(strsplit(Motif, '.', fixed = T))[4], by = Motif]
footprint_stats[, 'motif2' := ifelse(is.na(motif2), "", motif2)]
footprint_stats[, 'motif' := paste0(motif1, motif2)]
footprint_stats[, c('motif1', 'motif2') := NULL]
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 'Diff', 'non-Diff')]
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.26, .9),  legend.text = element_text(size=15), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10) + theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"))
p
#select a TF to show
sele.motif = 'CEBPE'
tf.file.name = footprint_stats[motif == sele.motif]$Motif
tf.file.name = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/', tf.file.name, '.txt')
dd = fread(tf.file.name)
dd[, 'id' := -99:100]
dd0 = rbind(subset(dd, select = - cluster_1))
dd1 = rbind(subset(dd, select = - cluster_0))
names(dd0)[1] = names(dd1)[1] = 'score'
dd = rbind(dd1, dd0)
dd$cluster = rep(c('cluster_1', 'cluster_0'), each = nrow(dd0))
p2 = ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif) + xlab('Distance to Motif') + theme(legend.title=element_blank(), legend.text = element_text(size=15), legend.background = NULL, axis.text = element_text(size = 15), axis.title = element_text(size = 15), legend.position = c(0.8, 0.8)) + theme(plot.margin=unit(c(1,1,1.5,1.2),"cm"))
grid.arrange(p, p2, nrow = 2)
}
library(pheatmap)
help("pheatmap")
footprint_stats.file = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/cluster_0_cluster_1_statistics.txt')
if(file.exists(footprint_stats.file)){
library(ggrepel)
library(gridExtra)
library(grid)
footprint_stats = fread(footprint_stats.file)
footprint_stats[, 'motif1' := unlist(strsplit(Motif, '.', fixed = T))[3], by = Motif]
footprint_stats[, 'motif2' := unlist(strsplit(Motif, '.', fixed = T))[4], by = Motif]
footprint_stats[, 'motif2' := ifelse(is.na(motif2), "", motif2)]
footprint_stats[, 'motif' := paste0(motif1, motif2)]
footprint_stats[, c('motif1', 'motif2') := NULL]
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 'Diff', 'non-Diff')]
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.26, .9),  legend.text = element_text(size=15), axis.text.x = element_blank(), legend.title = element_blank()) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10) + theme(plot.margin=unit(c(0.2,0.2,0.2,0.2),"cm"))
p
#select a TF to show
sele.motif = 'CEBPE'
tf.file.name = footprint_stats[motif == sele.motif]$Motif
tf.file.name = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/', tf.file.name, '.txt')
dd = fread(tf.file.name)
dd[, 'id' := -99:100]
dd0 = rbind(subset(dd, select = - cluster_1))
dd1 = rbind(subset(dd, select = - cluster_0))
names(dd0)[1] = names(dd1)[1] = 'score'
dd = rbind(dd1, dd0)
dd$cluster = rep(c('cluster_1', 'cluster_0'), each = nrow(dd0))
p2 = ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif) + xlab('Distance to Motif') + theme(legend.title=element_blank(), legend.text = element_text(size=15), legend.background = NULL, axis.text = element_text(size = 15), axis.title = element_text(size = 15), legend.position = c(0.8, 0.8)) + theme(plot.margin=unit(c(0.2,0.2,0.2,0.2),"cm"))
grid.arrange(p, p2, nrow = 2)
}
options(width = 500)
footprint_stats.file = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/cluster_0_cluster_1_statistics.txt')
if(file.exists(footprint_stats.file)){
library(ggrepel)
library(gridExtra)
library(grid)
footprint_stats = fread(footprint_stats.file)
footprint_stats[, 'motif1' := unlist(strsplit(Motif, '.', fixed = T))[3], by = Motif]
footprint_stats[, 'motif2' := unlist(strsplit(Motif, '.', fixed = T))[4], by = Motif]
footprint_stats[, 'motif2' := ifelse(is.na(motif2), "", motif2)]
footprint_stats[, 'motif' := paste0(motif1, motif2)]
footprint_stats[, c('motif1', 'motif2') := NULL]
footprint_stats[, 'isSig' := ifelse(P_values <= 0.05, 'Diff', 'non-Diff')]
p <- ggplot(data = footprint_stats, aes(x = motif, y = TF_Activity, colour = factor(isSig), label = motif)) + geom_point() + xlab("") + ylab('TF Activity Difference') + theme(legend.position=c(.26, .9),  legend.text = element_text(size=15), axis.text.x = element_blank(), legend.title = element_blank(), legend.background = NULL) + ggtitle('TF Activity difference: Cluster1 - Cluster0') + geom_text_repel(data = subset(footprint_stats, isSig == 'Diff'),
force = 10) + theme(plot.margin=unit(c(0.2, 0, 0.2, 0),"cm"))
p
#select a TF to show
sele.motif = 'CEBPE'
tf.file.name = footprint_stats[motif == sele.motif]$Motif
tf.file.name = paste0(params$downstream_dir, '/data_by_cluster/footprint/cluster_0_cluster_1/Lineplots/', tf.file.name, '.txt')
dd = fread(tf.file.name)
dd[, 'id' := -99:100]
dd0 = rbind(subset(dd, select = - cluster_1))
dd1 = rbind(subset(dd, select = - cluster_0))
names(dd0)[1] = names(dd1)[1] = 'score'
dd = rbind(dd1, dd0)
dd$cluster = rep(c('cluster_1', 'cluster_0'), each = nrow(dd0))
p2 = ggplot(data = dd, aes(x = id, y = score, colour = cluster)) + geom_line(aes(linetype = cluster), size = 1.1) + ggtitle(sele.motif) + xlab('Distance to Motif') + theme(legend.title=element_blank(), legend.text = element_text(size=15), legend.background = NULL, axis.text = element_text(size = 15), axis.title = element_text(size = 15), legend.position = c(0.8, 0.8)) + theme(plot.margin=unit(c(0.2,0,0.2,0),"cm"))
grid.arrange(p, p2, nrow = 2)
}
p
plotly(p)
library(plotly)
ggplotly(p)
ggplotly(p2)
p2
ggplotly(p2)
p2
library(pheatmap)
help("pheatmap")
reticulate::import('louvain')
getwd()
setwd("~/yuw1/scATAC-pro/scripts/src")
